<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simple TikTok + WebRTC Chat</title>

<style>
body {
  margin:0;
  padding:0;
  font-family: Arial;
  background:#000;
  color:#fff;
  overflow:hidden;
}

/* ===== Layout ===== */
#container {
  display:flex;
  height:100vh;
}

/* TikTok video feed */
#videos {
  width:70%;
  background:#000;
  overflow-y:scroll;
  scroll-snap-type:y mandatory;
}

.video {
  height:100vh;
  scroll-snap-align:start;
  display:flex;
  align-items:center;
  justify-content:center;
}

video {
  width:100%;
  height:100%;
  object-fit:cover;
}

/* Chat area */
#chat {
  width:30%;
  background:#111;
  display:flex;
  flex-direction:column;
  border-left:2px solid #222;
}

#messages {
  flex:1;
  overflow-y:auto;
  padding:10px;
}

#messages div {
  margin-bottom:10px;
  padding:8px;
  border-radius:6px;
  background:#222;
}

#inputBox {
  display:flex;
  padding:10px;
  background:#000;
}

#text {
  flex:1;
  padding:8px;
  border:none;
  border-radius:6px;
}

#send {
  width:70px;
  margin-left:10px;
  background:#444;
  color:#fff;
  border:none;
  border-radius:6px;
}

/* TikTok Add Form */
#addForm {
  padding:10px;
  background:#000;
  border-bottom:1px solid #222;
}

#videoURL {
  width:80%;
  padding:6px;
  border-radius:6px;
  border:none;
}
</style>
</head>

<body>

<div id="container">

  <!-- TikTok Section -->
  <div id="videos">
      <div id="addForm">
        <input type="text" id="videoURL" placeholder="Paste TikTok direct MP4 link">
        <button onclick="addVideo()">Add</button>
      </div>
  </div>

  <!-- Chat Section -->
  <div id="chat">
    <div id="messages"></div>

    <div id="inputBox">
      <input id="text" placeholder="Type message...">
      <button id="send">Send</button>
    </div>
  </div>

</div>


<script>
/* ============================================================
   ================== VIDEO SYSTEM =============================
   ============================================================ */
function addVideo() {
  let url = document.getElementById("videoURL").value.trim();
  if(!url) return;

  let div = document.createElement("div");
  div.className = "video";

  let v = document.createElement("video");
  v.src = url;
  v.controls = true;
  v.autoplay = false;
  v.preload = "none";

  div.appendChild(v);
  document.getElementById("videos").appendChild(div);

  document.getElementById("videoURL").value = "";
}


/* ============================================================
   ================== WEBRTC P2P CHAT ==========================
   ============================================================ */

let pc = new RTCPeerConnection({
  iceServers: [{ urls: "stun:stun.l.google.com:19302" }]
});

let dataChannel = pc.createDataChannel("chat");
let messages = document.getElementById("messages");

// Show received messages
dataChannel.onmessage = e => {
  let div = document.createElement("div");
  div.innerText = "Stranger: " + e.data;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
};

// Send message
document.getElementById("send").onclick = () => {
  let text = document.getElementById("text").value;
  if (text.trim() === "") return;

  dataChannel.send(text);

  let div = document.createElement("div");
  div.innerText = "You: " + text;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;

  document.getElementById("text").value = "";
};

// Auto-connect using WebRTC Offer/Answer via URL hash
async function start() {
  if (!location.hash) {
    let offer = await pc.createOffer();
    await pc.setLocalDescription(offer);
    location.hash = btoa(JSON.stringify(offer));
  } else {
    let offer = JSON.parse(atob(location.hash.substring(1)));
    await pc.setRemoteDescription(offer);

    let answer = await pc.createAnswer();
    await pc.setLocalDescription(answer);

    // Copy this answer manually to the other user
    prompt("Send this answer to your partner:", btoa(JSON.stringify(answer)));
  }
}

start();
</script>

</body>
</html>
