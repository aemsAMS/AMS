<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chat + TikTok Viewer</title>

<style>
body {
    margin: 0;
    font-family: Arial;
    background: #111;
    color: #fff;
}

/* ---------- Login/Register ---------- */
#authBox {
    width: 90%;
    max-width: 350px;
    margin: 80px auto;
    background: #222;
    padding: 20px;
    border-radius: 8px;
}

input {
    width: 100%;
    padding: 10px;
    margin: 8px 0;
    background: #333;
    border: none;
    border-radius: 6px;
    color: #fff;
}

button {
    width: 100%;
    padding: 10px;
    background: #ff0050;
    color: #fff;
    border: none;
    border-radius: 6px;
    margin-top: 10px;
    cursor: pointer;
}

nav {
    display: flex;
    background: #000;
}

nav button {
    flex: 1;
    border-radius: 0;
}

/* ---------- Main Screens ---------- */
.page {
    display: none;
    height: 100vh;
    overflow-y: auto;
}

/* ---------- Chat List ---------- */
.chat-user {
    padding: 15px;
    border-bottom: 1px solid #333;
    cursor: pointer;
}

.chat-user:hover {
    background: #222;
}

/* ---------- Messages ---------- */
#chatMessages {
    padding: 15px;
}

.msg {
    padding: 10px;
    background: #222;
    margin-bottom: 10px;
    width: fit-content;
    max-width: 80%;
    border-radius: 6px;
}

.me {
    background: #ff0050;
    margin-left: auto;
    text-align: right;
}

/* ---------- TikTok Video ---------- */
video {
    width: 100%;
    margin-top: 10px;
    border-radius: 10px;
}
</style>
</head>
<body>

<!-- AUTH BOX -->
<div id="authBox">
    <h3>ثبت نام / ورود</h3>
    <input id="username" placeholder="نام کاربری">
    <input id="password" placeholder="رمز عبور" type="password">
    <button onclick="register()">ثبت نام</button>
    <button onclick="login()">ورود</button>
    <p id="authMsg" style="color:#f55;margin-top:10px;"></p>
</div>

<!-- NAV -->
<nav id="menu" style="display:none;">
    <button onclick="openPage('videosPage')">ویدئوها</button>
    <button onclick="openPage('chatPage')">چت</button>
</nav>

<!-- PAGE: VIDEOS -->
<div class="page" id="videosPage">
    <h2 style="text-align:center;">ویدئوهای تیک تاک</h2>
    <div id="videoList"></div>
</div>

<!-- PAGE: CHAT USERS -->
<div class="page" id="chatPage">
    <h2 style="text-align:center;">کاربران</h2>
    <input id="searchUser" placeholder="جستجوی کاربر..." oninput="searchUsers()">
    <div id="usersList"></div>
</div>

<!-- PAGE: CHAT ROOM -->
<div class="page" id="roomPage">
    <h2 id="roomTitle" style="text-align:center;"></h2>
    <div id="chatMessages"></div>

    <div style="padding:10px; position:fixed; bottom:0; width:100%; background:#000;">
        <input id="msgBox" placeholder="پیام...">
        <button onclick="sendMessage()">ارسال</button>
    </div>
</div>

<script>
// --------------------- DATABASE SIMULATION ---------------------
if (!localStorage.users) localStorage.users = JSON.stringify({});
if (!localStorage.messages) localStorage.messages = JSON.stringify({});

let currentUser = null;

// --------------------- AUTH ---------------------
function register() {
    let user = username.value.trim();
    let pass = password.value.trim();
    if (!user || !pass) return authMsg.innerText = "فیلدها پر نیست";

    let db = JSON.parse(localStorage.users);

    if (db[user]) {
        authMsg.innerText = "این نام کاربری قبلاً گرفته شده";
        return;
    }

    db[user] = { password: pass };
    localStorage.users = JSON.stringify(db);

    authMsg.style.color = "lime";
    authMsg.innerText = "ثبت نام انجام شد، اکنون وارد شوید";
}

function login() {
    let user = username.value.trim();
    let pass = password.value.trim();
    let db = JSON.parse(localStorage.users);

    if (!db[user]) return authMsg.innerText = "نام کاربری وجود ندارد";
    if (db[user].password !== pass) return authMsg.innerText = "رمز اشتباه است";

    currentUser = user;
    authBox.style.display = "none";
    menu.style.display = "flex";
    openPage("videosPage");
}

// --------------------- PAGE SWITCH ---------------------
function openPage(id) {
    document.querySelectorAll('.page').forEach(p => p.style.display = "none");
    document.getElementById(id).style.display = "block";

    if (id === "chatPage") loadUsers();
    if (id === "videosPage") loadVideos();
}

// --------------------- TIKTOK VIDEOS ---------------------
let tiktokVideos = [
    // اینجا لینک ویدئوهای تیک تاک را بگذار
    "video1.mp4",
    "video2.mp4",
    "video3.mp4"
];

function loadVideos() {
    let box = document.getElementById("videoList");
    box.innerHTML = "";
    tiktokVideos.forEach(link => {
        box.innerHTML += `<video src="${link}" controls></video>`;
    });
}

// --------------------- USERS LIST ---------------------
function loadUsers() {
    let db = JSON.parse(localStorage.users);
    let box = document.getElementById("usersList");
    box.innerHTML = "";

    Object.keys(db).forEach(u => {
        if (u !== currentUser)
            box.innerHTML += `<div class='chat-user' onclick="openChat('${u}')">${u}</div>`;
    });
}

function searchUsers() {
    let txt = searchUser.value.toLowerCase();
    let db = JSON.parse(localStorage.users);
    let box = document.getElementById("usersList");
    box.innerHTML = "";

    Object.keys(db).forEach(u => {
        if (u !== currentUser && u.toLowerCase().includes(txt))
            box.innerHTML += `<div class='chat-user' onclick="openChat('${u}')">${u}</div>`;
    });
}

// --------------------- CHAT ---------------------
let currentChat = null;

function openChat(user) {
    currentChat = user;
    roomTitle.innerText = "چت با " + user;

    openPage("roomPage");
    loadMessages();
}

function loadMessages() {
    let db = JSON.parse(localStorage.messages);
    let key = chatKey(currentUser, currentChat);

    let msgs = db[key] || [];
    let box = chatMessages;
    box.innerHTML = "";

    msgs.forEach(m => {
        box.innerHTML += `<div class="msg ${m.from===currentUser?"me":""}">${m.text}</div>`;
    });

    box.scrollTop = box.scrollHeight;
}

function sendMessage() {
    let text = msgBox.value.trim();
    if (!text) return;

    let db = JSON.parse(localStorage.messages);
    let key = chatKey(currentUser, currentChat);
    if (!db[key]) db[key] = [];

    db[key].push({ from: currentUser, text });

    localStorage.messages = JSON.stringify(db);
    msgBox.value = "";
    loadMessages();
}

function chatKey(a, b) {
    return [a, b].sort().join("_");
}
</script>

</body>
</html> 
